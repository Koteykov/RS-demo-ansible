# RS-demo-ansible
Это конфигурация для Ansible, с помощью которой будут настроены 3 Apache-сервера 1 HAproxy-сервер на основе CentOS. Все таски выделены в роли. Используется динамический инвентарь с помощью плагина aws_ec2.

## ansible.cfg
Основной конфигурационный файл. В нём указано:
- В качестве инвентаря использовать inventory_aws_ec2.yaml
- Использовать плагин aws_ec2 для динамического инвентаря

## inventory_aws_ec2.yaml
Динамический инвентарь. С помощью него Ansible узнаёт ip-адреса серверов напрямую из облака AWS. Благодаря этому удалённые сервера могут быть как со статическими, так и с динамическими ip-адресами, для Ansible ко всем сможет покдлючиться.

## main.yaml
Основной плейбук. В нём:
- Проверяется, открыт ли на удалённых серверах SSH порт
- Если порт открыт, запускаются следующие роли
- Настраивается Apache на 3х серверах
- Настраивается HAproxy на 1м сервере

## roles/deploy_apache/tasks/main.yaml
- Устанавливаются пакеты: python3, httpd, libselinux-python3. Последний нужен для использования sed в дальнейшем.
- Настраивается текст "Welcome to hostname" в index.html
- С помощью sed "hostname" заменяется на $(hostname) машины
- Запускается httpd сервис

## roles/deploy_haproxy/tasks/main.yaml
- Устанавливаются пакеты: python3, haproxy
- /etc/haproxy/haproxy.cfg заменяется нужным haproxy.cfg из проекта
- Рестартится haproxy сервис
